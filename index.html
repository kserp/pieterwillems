<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pieter Willems</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fff;
      color: #222;
      text-align: center;
    }
    #canvas-holder {
      margin: 0 auto;
      max-width: 100%;
      cursor: pointer;
    }
    .glitchy {
      filter: contrast(130%);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/addons/p5.sound.min.js"></script>
</head>
<body>
  <div id="canvas-holder"></div>

  <script>
    let palette;
    let offsets = [];
    let spacing = 8;
    let pg;
    let fontSize;
    let glitchMode = false;
    let soundSketchInstance = null;

    function setup() {
      let cnv = createCanvas(windowWidth, 400);
      cnv.parent("canvas-holder");
      frameRate(30);

      palette = [
        color(40, 40, 200),
        color(40, 40, 200),
        color(40, 40, 200),
        color(40, 40, 200)
      ];

      offsets = [];
      for (let x = spacing; x < width; x += spacing) {
        for (let y = spacing; y < height; y += spacing) {
          offsets.push({
            x: x,
            y: y,
            angleOffset: random(1000),
            lenOffset: random(1000)
          });
        }
      }

      drawMask();
      document.getElementById("canvas-holder").addEventListener("click", toggleMode);
    }

    function drawMask() {
      pg = createGraphics(width, height);
      pg.clear();
      pg.textAlign(CENTER, CENTER);
      fontSize = windowWidth < 600 ? 80 : 140;
      pg.textSize(fontSize);

      if (glitchMode) {
        pg.background(0);
        pg.fill(255);
      } else {
        pg.fill(255);
      }

      if (windowWidth < 600) {
        pg.text("Pieter", width / 2, height / 2 - fontSize * 0.4);
        pg.text("Willems", width / 2, height / 2 + fontSize * 0.6);
      } else {
        pg.text("Pieter Willems", width / 2, height / 2);
      }
    }

    function draw() {
      background(255);
      let t = millis() * 0.0003;
      let linesLayer = createGraphics(width, height);
      linesLayer.strokeWeight(1.5);

      for (let o of offsets) {
        linesLayer.push();
        linesLayer.translate(o.x, o.y);
        let angle = noise(o.x * 0.05, o.y * 0.05, t + o.angleOffset) * TWO_PI * 2;
        linesLayer.rotate(angle);
        let baseLen = noise(o.x * 0.1, o.y * 0.1, t * 0.8 + o.lenOffset) * 8 + 3;

        if (glitchMode) {
          linesLayer.stroke(random(0, 50));
          baseLen *= random(0.5, 1.8);
        } else {
          if (random() < 0.9) {
            linesLayer.stroke(palette[0]);
          } else {
            linesLayer.stroke(random(palette.slice(1)));
          }
        }

        linesLayer.line(-baseLen / 2, 0, baseLen / 2, 0);
        linesLayer.pop();
      }

      let linesImg = linesLayer.get();
      let maskImg = pg.get();
      linesImg.mask(maskImg);
      image(linesImg, 0, 0);
    }

    function windowResized() {
      resizeCanvas(windowWidth, 400);
      setup();
    }

    function toggleMode() {
      glitchMode = !glitchMode;
      document.getElementById("canvas-holder").classList.toggle("glitchy", glitchMode);
      drawMask();

      if (glitchMode) {
        if (!soundSketchInstance) {
          soundSketchInstance = new p5(soundSketch, "body");
        }
      } else {
        if (soundSketchInstance) {
          soundSketchInstance.remove();
          soundSketchInstance = null;
        }
      }
    }
  </script>

  <script src="sketch.js"></script>
</body>
</html>